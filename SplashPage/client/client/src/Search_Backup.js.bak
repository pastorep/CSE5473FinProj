//React
import React, { Component } from 'react';

//Project
import Facets from './Facets';
import SearchBar from './SearchBar';
import Results from './Results';
import Filters from './Filters';

//Antd
import { Row, Col, Layout, Menu, Breadcrumb, Icon, Divider } from 'antd';

const { SubMenu } = Menu;
const { Header, Content, Footer, Sider } = Layout;

//TEST data
const testData = [{
key: '1',
flightNumber: '#732QS',
etd: '12:00',
eta: '12:00',
depart: 'ABC',
arrive: 'XYZ',
flown: <span><Icon type="caret-down" /> Not Flown</span>,
}, {
key: '2',
flightNumber: '#732QS',
etd: '12:00',
eta: '12:00',
depart: 'ABC',
arrive: 'XYZ',
flown: <span><Icon type="caret-up" /> Flown</span>,
}];

class Search extends Component {

  constructor(props) {
    super(props)

    console.log('constructing search view');
    console.log(this.props.results);

    //this perserves results between views
    this.state = {
      results : this.props.results,
    };

    //this is the defualt search
    if(Object.keys(this.props.results).length === 0){
      this.queryFlights();
    }
  }

  searchCallback = () => {
    this.queryFlights()
  }

  switchToDetail = () => {
    console.log('switchToDetail: in Search');
    console.log(this.state.results);
    this.props.switchToDetail(this.state.results);
  }

  //TODO send actual query to database
  queryFlights() {
        fetch('http://localhost:3001/query/').then(res => res.json()).then(res => this.setState({results : res})).then(console.log(this.state));
  }

  render() {
    return (
      <div>
        <Row>
          <Col span={18} push={3}>
            <div style={{ background: '#FFFFFF', padding: '', 'marginTop': '30px'}}>
              <SearchBar callback={this.searchCallback}/>
            </div>
          </Col>
        </Row>
        <Row>
          <Col span={22} push={1}>
            <div style={{ background: '#FFFFFF', padding: '', 'marginTop': '30px'}}>
            <Results results={this.state.results.hits} switchToDetail={this.switchToDetail}/>
            </div>
        </Col>
      </Row>
    </div>
    );
  }
}

export default Search;
